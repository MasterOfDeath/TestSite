@using TestSite.PL.WebPages.Models
@{
    Layout = "~/_Layout.cshtml";
    PageData["Title"] = "Администрирование";

    const string adminRole = "admin";

    string errorMessage = null;

    var log = TestSite.Logger.Logger.Log;

    if (!User.Identity.IsAuthenticated)
    {
        Response.StatusCode = 401;
        return;
    }

    if (!User.IsInRole(adminRole) && !User.IsInRole("superadmin") && !User.IsInRole("inspector"))
    {
        Response.StatusCode = 403;
        return;
    }
}

@if (errorMessage != null)
{
    <div class="alert alert-danger">@errorMessage</div>
}

<div class="content content-admin container-fluid" data-user-id="@User.Identity.Name">
    <div class="row">
        <div class="alert alert-success col-md-8 hide" role="alert">
            <button type="button" class="close">
                <span aria-hidden="true">&times;</span>
            </button>
            <p></p>
        </div>
    </div>

    <ul class="nav nav-tabs">
        @if (User.IsInRole(adminRole))
        {
            <li class="listTests active"><a data-toggle="tab" href="#testsTab">Тесты</a></li>
            <li class="editTest hide"><a data-toggle="tab" href="#editTestTab"><b>Редактирование</b></a></li>
            <li><a data-toggle="tab" href="#personalTab">Персонал</a></li>
            <li><a data-toggle="tab" href="#reportTab">Статистика моего отдела</a></li>
        }
        @if (User.IsInRole("superadmin"))
        {
            <li class="active"><a data-toggle="tab" href="#depsTab">Отделы</a></li>
        }
    </ul>

    <div class="tab-content">

        @if (User.IsInRole(adminRole))
        {
            <div id="testsTab" class="tab-pane fade in active tests-tab">
                <!-- Tests tab -->
                @RenderPage("~/Pages/_TestsTabPartial.cshtml")
                <!--  -->
            </div>

            <div id="editTestTab" class="tab-pane fade in editTest-tab" data-test-id="-1" data-test-name="">
                <!-- Tests tab -->
                @RenderPage("~/Pages/_EditTestTabPartial.cshtml")
                <!--  -->
            </div>

            <div id="personalTab" class="tab-pane fade in personal-tab">
                <!-- Personal tab -->
                @RenderPage("~/Pages/_PersonalTabPartial.cshtml")
                <!--  -->
            </div>

            <div id="reportTab" class="tab-pane fade in report-tab">
                <!-- Report tab -->
                @RenderPage("~/Pages/_ReportTabPartial.cshtml")
                <!--  -->

            </div>
        }

        @if (User.IsInRole("superadmin"))
        {
            <div id="depsTab" class="tab-pane fade in active deps-tab">
                <!-- Tests tab -->
                @RenderPage("~/Pages/_DepsTabPartial.cshtml")
                <!--  -->
            </div>
        }

        <!-- Modal for edit and create test -->
        @RenderPage("~/Pages/_NamePromptPartial.cshtml")
        <!--  -->
        <!-- Modal for preview test -->
        @RenderPage("~/Pages/_AdminTestPreviewPartial.cshtml")
        <!--  -->
        <!-- Modal for edit and create question -->
        @RenderPage("~/Pages/_QuestionPromptPartial.cshtml")
        <!--  -->
        <!-- Modal for remove -->
        @RenderPage("~/Pages/_RemovePromptPartial.cshtml")
        <!--  -->
        <!-- Modal for create/edit employee -->
        @RenderPage("~/Pages/_EmployeePromptPartial.cshtml")
        <!--  -->

    </div> <!-- tab-content / end -->
    <!-- ErrorModal -->
    @RenderPage("~/Pages/_ErrorModalPartial.cshtml")
    <!--  -->
</div> <!-- container / end -->


@section header {
    <link rel="icon" type="image/png" href="~/images/icons/adminka.png" />
    <link href="~/Content/bootstrap-datepicker3.min.css" rel="stylesheet" />
    <link href="~/Content/ProjectStyles/admin.css" rel="stylesheet" />
    <link href="~/Content/ProjectStyles/generals/reportTab.css" rel="stylesheet" />
    <link href="~/Content/ProjectStyles/generals/tables.css" rel="stylesheet" />
    <link href="~/Content/ProjectStyles/generals/schema.css" rel="stylesheet" />
    <link href="~/Content/ProjectStyles/generals/testTabs.css" rel="stylesheet" />
}

@section scripts {
    <script src="~/Scripts/jquery.panzoom.min.js"></script>
    <script src="~/Scripts/jquery.imagefit-0.2.js"></script>
    <script src="~/Scripts/jquery.fileDownload.js"></script>
    <script src="~/Scripts/spin.min.js"></script>
    <script src="~/Scripts/bootstrap-datepicker.min.js"></script>
    <script src="~/Scripts/locales/bootstrap-datepicker.ru.min.js"></script>
    <script src="~/Scripts/ProjectScripts/admin.js"></script>
    <script src="~/Scripts/ProjectScripts/admin-test-preview.js"></script>
    <script src="~/Scripts/ProjectScripts/admin-report.js"></script>
    <script src="~/Scripts/ProjectScripts/admin-personal.js"></script>
}