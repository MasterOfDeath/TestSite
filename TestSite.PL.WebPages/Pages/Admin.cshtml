@using TestSite.PL.WebPages.Models
@{
    Layout = "~/_Layout.cshtml";
    PageData["Title"] = "Администрирование";

    const string adminRole = "admin";

    string errorMessage = null;
    ICollection<TestSite.Entites.Test> tests = null;

    var log = TestSite.Logger.Logger.Log;

    if (!User.Identity.IsAuthenticated)
    {
        Response.StatusCode = 401;
        return;
    }

    if (!User.IsInRole(adminRole))
    {
        Response.StatusCode = 403;
        return;
    }

    if (!IsPost)
    {
        try
        {
            tests = LogicProvider.TestLogic.ListAllTests();
        }
        catch (Exception ex)
        {
            errorMessage = ex.Message;
            log.Error("ListAllTests", ex);
        }
    }
}

@if (errorMessage != null)
{
    <div class="alert alert-danger">@errorMessage</div>
}

<div class="content content-admin container-fluid" data-user-id="@User.Identity.Name">
    <div class="row">
        <div class="alert alert-success col-md-8 hide" role="alert">
            <button type="button" class="close">
                <span aria-hidden="true">&times;</span>
            </button>
            <p></p>
        </div>
    </div>

    <ul class="nav nav-tabs">
        <li class="listTests active"><a data-toggle="tab" href="#testsTab">Тесты</a></li>
        <li class="editTest hide"><a data-toggle="tab" href="#editTestTab">Редактирование</a></li>
    </ul>

    <div class="tab-content">
        <div id="testsTab" class="tab-pane fade in active tests-tab">
            <button class="btn btn-primary addTestBtn">Создать тест</button>

            <div class="table-responsive">
                <table class="table table-hover tests-table">
                    <tbody>
                        @if (tests != null)
	                    {
		                    foreach (var test in tests)
                            {
                                <tr data-id="@test.Id"><td>@test.Name</td></tr>
                            }
                        }
                    </tbody>
                </table>
            </div>
        </div>

        <div id="editTestTab" class="tab-pane fade in editTest-tab" data-test-id="-1">
            <h2>Обрыв 100км</h2>

            <div class="btn-group">
                <button class="btn btn-primary addQuestionBtn">Добавить вопрос</button>
                <button class="btn btn-default testPreviewBtn">Просмотр теста</button>
                <button class="btn btn-default editTestBtn">Изменить название теста</button>
                <button class="btn btn-default removeTestBtn">Удалить тест</button>
            </div>

            <table class="table table-hover questions-table">
                <tbody>
                    <!-- for replace -->
                </tbody>
            </table>

        </div>

        <!-- Modal for edit and create test -->
        @RenderPage("~/Pages/_NamePromptPartial.cshtml")
        <!--  -->

        <!-- Modal for preview test -->
        @RenderPage("~/Pages/_TestPreviewPartial.cshtml")
        <!--  -->

        <!-- Modal for edit and create question -->
        @RenderPage("~/Pages/_QuestionPromptPartial.cshtml")
        <!--  -->

        <!-- Modal for delete -->
        @RenderPage("~/Pages/_RemovePromptPartial.cshtml")
        <!--  -->

    </div> <!-- tab-content / end -->
    <!-- ErrorModal -->
    @RenderPage("~/Pages/_ErrorModalPartial.cshtml")
    <!--  -->
</div> <!-- container / end -->


@section header {
    <link rel="icon" type="image/png" href="~/images/employee_icon.png" />
    <link href="~/Content/ProjectStyles/admin.css" rel="stylesheet" />
}

@section scripts {
    <script src="~/Scripts/ProjectScripts/admin.js"></script>
    <script src="~/Scripts/ProjectScripts/admin-test-preview.js"></script>
}